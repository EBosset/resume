<div class="portfolio-panel" *ngIf="discipline">
  <div class="portfolio-panel__header">
    <p class="portfolio-panel__category">{{ discipline.label | uppercase }}</p>
    <p class="portfolio-panel__summary">{{ discipline.summary }}</p>
  </div>

  <div class="portfolio-panel__projects">
    @for (project of discipline.projects; track project.id) {
      <article class="portfolio-project">
        <div class="portfolio-project__media">
          <div class="portfolio-project__media-main">
            <img
              [src]="activeImage(project)"
              [alt]="project.title"
              loading="lazy"
              (click)="openLightbox(activeImage(project), project.title)"
            />
          </div>

          @if (project.gallery?.length) {
            <div class="portfolio-project__media-thumbs">
              @for (thumb of project.gallery; track $index) {
                <button
                  type="button"
                  class="portfolio-project__thumb"
                  [class.portfolio-project__thumb--active]="activeImage(project) === thumb"
                  (click)="selectImage(project.id, thumb)"
                >
                  <img [src]="thumb" [alt]="project.title + ' vignette'" />
                </button>
              }
            </div>
          }
        </div>

        <div class="portfolio-project__body">
          <div class="portfolio-project__meta">
            <span class="portfolio-project__role">{{ project.role }}</span>
            <span class="portfolio-project__stack">
              @for (tech of project.stack; track tech) {
                <span class="portfolio-project__stack-badge">{{ tech }}</span>
              }
            </span>
          </div>

          <h3 class="portfolio-project__title">{{ project.title }}</h3>
          <p class="portfolio-project__description text-preline">{{ project.description }}</p>

          <!--
          <a
            class="portfolio-project__cta"
            [href]="project.link"
            target="_blank"
            rel="noopener"
          >
            Voir le projet
          </a>
          -->
        </div>
      </article>
    }
  </div>
  <div
    class="portfolio-lightbox"
    *ngIf="lightboxImage() as image"
    (click)="closeLightbox()"
  >
    <div
      class="portfolio-lightbox__content"
      (click)="$event.stopPropagation()"
      (wheel)="onLightboxWheel($event)"
      (mousedown)="onLightboxMouseDown($event)"
      (mousemove)="onLightboxMouseMove($event)"
      (mouseup)="onLightboxMouseUp()"
      (mouseleave)="onLightboxMouseLeave()"
    >
      <img
        [src]="image"
        [alt]="lightboxAlt()"
        (contextmenu)="$event.preventDefault()"
        [style.transform]="'translate(' + lightboxOffsetX() + 'px, ' + lightboxOffsetY() + 'px) scale(' + lightboxZoom() + ')'"
        style="transform-origin: center center;"
        loading="lazy"
      />
      <button
        type="button"
        class="portfolio-lightbox__close"
        (click)="closeLightbox(); $event.stopPropagation()"
      >
        Ã—
      </button>
    </div>
  </div>
</div>